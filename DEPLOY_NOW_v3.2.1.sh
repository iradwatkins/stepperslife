#!/bin/bash

# SteppersLife v3.2.1 PRODUCTION DEPLOYMENT
# ==========================================
# CRITICAL: Coolify is BROKEN - Direct Docker deployment ONLY
# Date: 2025-08-25

echo "🚀 SteppersLife v3.2.1 - CRITICAL FIX DEPLOYMENT"
echo "================================================="
echo ""
echo "This script will deploy the following fixes:"
echo "✅ Event Categories selection fixed"
echo "✅ Calendar day headers properly aligned"
echo "✅ Date/time pickers working correctly"
echo "✅ Event update functionality fixed"
echo ""
echo "⚠️  IMPORTANT: This script must be run ON THE SERVER"
echo ""
echo "To deploy:"
echo "1. SSH to server: ssh root@72.60.28.175"
echo "2. Run these commands:"
echo ""
echo "cd /opt && rm -rf stepperslife"
echo "git clone https://github.com/iradwatkins/stepperslife.git"
echo "cd stepperslife"
echo ""
echo "# Create build config"
echo "cat > next.config.js << 'EOF'"
echo "const nextConfig = {"
echo "  eslint: { ignoreDuringBuilds: true },"
echo "  typescript: { ignoreBuildErrors: true },"
echo "  output: 'standalone',"
echo "  images: { remotePatterns: [{ protocol: 'https', hostname: '**' }] }"
echo "}"
echo "module.exports = nextConfig"
echo "EOF"
echo ""
echo "# Set environment"
echo "cat > .env.production << 'EOF'"
echo "NODE_ENV=production"
echo "PLATFORM_FEE_PER_TICKET=1.50"
echo "NEXTAUTH_URL=https://stepperslife.com"
echo "NEXTAUTH_SECRET=MNPqnyyK7CDiaLwgHQEj+cpt0miM03ff0ECPxl5VKdc="
echo "GOOGLE_CLIENT_ID=1009301533734-s9lbcqhrhehvtmd2bbrpkuvf4oo7ov3v.apps.googleusercontent.com"
echo "GOOGLE_CLIENT_SECRET=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"
echo "NEXT_PUBLIC_CONVEX_URL=https://mild-newt-621.convex.cloud"
echo "CONVEX_DEPLOYMENT=prod:mild-newt-621"
echo "NEXT_PUBLIC_APP_URL=https://stepperslife.com"
echo "NEXT_PUBLIC_APP_NAME=SteppersLife"
echo "NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=AIzaSyAD1jQHxD0Y7TfZzv8D8V7o7DfwB7CjJxE"
echo "EOF"
echo ""
echo "# Build and deploy"
echo "docker build --no-cache -t stepperslife:v3.2.1 ."
echo "docker stop stepperslife-prod 2>/dev/null || true"
echo "docker rm stepperslife-prod 2>/dev/null || true"
echo ""
echo "docker run -d \\"
echo "  --name stepperslife-prod \\"
echo "  --restart unless-stopped \\"
echo "  --network coolify \\"
echo "  -p 3000:3000 \\"
echo "  --env-file .env.production \\"
echo "  --label \"traefik.enable=true\" \\"
echo "  --label \"traefik.http.routers.stepperslife.rule=Host(\\\`stepperslife.com\\\`)\" \\"
echo "  --label \"traefik.http.services.stepperslife.loadbalancer.server.port=3000\" \\"
echo "  stepperslife:v3.2.1"
echo ""
echo "# Verify deployment"
echo "docker ps | grep stepperslife-prod"
echo "curl http://localhost:3000/api/auth/providers"
echo ""
echo "================================"
echo "COPY AND RUN THE COMMANDS ABOVE ON THE SERVER"
echo "================================"